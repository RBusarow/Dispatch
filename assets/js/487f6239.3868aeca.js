"use strict";(self.webpackChunkdispatch=self.webpackChunkdispatch||[]).push([[808],{3380:(t,e,i)=>{i.r(e),i.d(e,{assets:()=>p,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=i(7462),n=(i(7294),i(3905));i(8209);const o={id:"dispatch-test",title:"Test Core",sidebar_label:"Test Core"},a=void 0,s={unversionedId:"modules/dispatch-test",id:"modules/dispatch-test",title:"Test Core",description:"Test helpers for the [dispatch-core] module. Most of the tools you need to automatically",source:"@site/docs/modules/dispatch-test.md",sourceDirName:"modules",slug:"/modules/dispatch-test",permalink:"/Dispatch/docs/next/modules/dispatch-test",draft:!1,editUrl:"https://github.com/rbusarow/Dispatch/edit/main/website/docs/modules/dispatch-test.md",tags:[],version:"current",frontMatter:{id:"dispatch-test",title:"Test Core",sidebar_label:"Test Core"},sidebar:"Docs",previous:{title:"ViewModel",permalink:"/Dispatch/docs/next/modules/dispatch-android-viewmodel"},next:{title:"Test JUnit4",permalink:"/Dispatch/docs/next/modules/dispatch-test-junit4"}},p={},c=[{value:"TestDispatcherProvider",id:"testdispatcherprovider",level:2},{value:"Constructor with default arguments",id:"constructor-with-default-arguments",level:3},{value:"Single-arg factory",id:"single-arg-factory",level:3},{value:"Basic TestDispatcherProvider",id:"basic-testdispatcherprovider",level:3},{value:"TestProvidedCoroutineScope",id:"testprovidedcoroutinescope",level:2},{value:"Builders",id:"builders",level:2},{value:"Minimum Gradle Config",id:"minimum-gradle-config",level:3}],l={toc:c};function h(t){let{components:e,...i}=t;return(0,n.kt)("wrapper",(0,r.Z)({},l,i,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Test helpers for the ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/index.html"},"dispatch-core")," module. Most of the tools you need to automatically\nhandle ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/-dispatcher-provider/index.html"},"DispatcherProvider")," in your tests.  (see ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test-junit4/dispatch.test/index.html"},"dispatch-test-junit4")," or ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test-junit5/dispatch.test/index.html"},"dispatch-test-junit5"),"\nfor the rest.)"),(0,n.kt)("h2",{id:"testdispatcherprovider"},"TestDispatcherProvider"),(0,n.kt)("p",null,"Testing version of the ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/-dispatcher-provider/index.html"},"DispatcherProvider")," with three main styles of creation:"),(0,n.kt)("h3",{id:"constructor-with-default-arguments"},"Constructor with default arguments"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test/dispatch.test/-test-dispatcher-provider/index.html"},"(link)")),(0,n.kt)("p",null,"Each property becomes its own ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/-test-coroutine-dispatcher/index.html"},"TestCoroutineDispatcher")," by default, but may be replaced by\nany ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/index.html"},"CoroutineDispatcher"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kotlin"},'val customTestDispatcherProvider = TestDispatcherProvider(\n  default = newSingleThreadContext("default"),\n  io = newSingleThreadContext("io"),\n  main = newSingleThreadContext("main"),\n  mainImmediate = newSingleThreadContext("main immediate"),\n  unconfined = newSingleThreadContext("unconfined")\n)\n\nval defaultTetsDispatcherProvider = TestDispatcherProvider()\n')),(0,n.kt)("h3",{id:"single-arg-factory"},"Single-arg factory"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test/dispatch.test/-test-dispatcher-provider/index.html"},"(link)")),(0,n.kt)("p",null,"Another option is to pass a single ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/index.html"},"CoroutineDispatcher"),", which is then used to populate all fields."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kotlin"},'val dispatcher = newSingleThreadContext("custom")\n\nval dispatcherProvider = TestDispatcherProvider(dispatcher)\n\ndispatcherProvider.default shouldBe myDispatcher\ndispatcherProvider.io shouldBe myDispatcher\ndispatcherProvider.main shouldBe myDispatcher\ndispatcherProvider.mainImmediate shouldBe myDispatcher\ndispatcherProvider.unconfined shouldBe myDispatcher\n')),(0,n.kt)("h3",{id:"basic-testdispatcherprovider"},"Basic TestDispatcherProvider"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test/dispatch.test/-test-dispatcher-provider/index.html"},"(link)")),(0,n.kt)("p",null,"Sometimes we want to have the normal dispatch behaviors of a production environment, just without\nthe awkward mechanics of ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/kotlinx.coroutines.-dispatchers/set-main.html"},"Dispatchers.setMain"),"."),(0,n.kt)("p",null,"This is essentially ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/-default-dispatcher-provider/index.html"},"DefaultDispatcherProvider")," except with\na ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/new-single-thread-context.html"},"single-threaded executor"),' handling the "main" thread.'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kotlin"},'fun TestBasicDispatcherProvider(): TestDispatcherProvider {\n\n  val mainThread = newSingleThreadContext("main thread proxy")\n\n  return TestDispatcherProvider(\n    default = Dispatchers.Default,\n    io = Dispatchers.IO,\n    main = mainThread,\n    mainImmediate = mainThread,\n    unconfined = Dispatchers.Unconfined\n  )\n}\n')),(0,n.kt)("h2",{id:"testprovidedcoroutinescope"},"TestProvidedCoroutineScope"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test/dispatch.test/-test-provided-coroutine-scope/index.html"},"(link)")),(0,n.kt)("p",null,"A polymorphic ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html"},"CoroutineScope")," which implements all the type-safe versions from ",(0,n.kt)("a",{parentName:"p",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/index.html"},"dispatch-core"),", as\nwell as ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/-test-coroutine-scope/index.html"},"TestCoroutineScope"),"."),(0,n.kt)("p",null,"This type may be injected anywhere, regardless of the requirement."),(0,n.kt)("h2",{id:"builders"},"Builders"),(0,n.kt)("p",null,"Sometimes, instead of explicitly creating a ",(0,n.kt)("a",{parentName:"p",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html"},"CoroutineScope")," object, we prefer to just use a\ncoroutineScope builder function within a function."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kotlin"},"@Test\nfun some_test() = runBlockingProvided {\n  someSuspendFunction()\n}\n\n@Test\nfun some_test() = testProvided {\n  someSuspendFunctionWithADelay()\n}\n")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"th"},"Name")),(0,n.kt)("th",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"th"},"Description")))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test/dispatch.test/run-blocking-provided.html"},"runBlockingProvided")),(0,n.kt)("td",{parentName:"tr",align:null},"Uses ",(0,n.kt)("a",{parentName:"td",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/run-blocking.html"},"runBlocking"),", but injects a ",(0,n.kt)("a",{parentName:"td",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/-dispatcher-provider/index.html"},"DispatcherProvider")," into its ",(0,n.kt)("a",{parentName:"td",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html"},"CoroutineScope"),". Use this function if you want normal dispatch behavior.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://rbusarow.github.io/Dispatch/api/dispatch-test/dispatch.test/test-provided.html"},"testProvided")),(0,n.kt)("td",{parentName:"tr",align:null},"Uses ",(0,n.kt)("a",{parentName:"td",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/run-blocking-test.html"},"runBlockingTest"),", but injects a ",(0,n.kt)("a",{parentName:"td",href:"https://rbusarow.github.io/Dispatch/api/dispatch-core/dispatch.core/-dispatcher-provider/index.html"},"DispatcherProvider")," into its ",(0,n.kt)("a",{parentName:"td",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/-test-coroutine-scope/index.html"},"TestCoroutineScope"),". Use this function if you want the explicit time control of ",(0,n.kt)("a",{parentName:"td",href:"https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/run-blocking-test.html"},"runBlockingTest"),".")))),(0,n.kt)("h3",{id:"minimum-gradle-config"},"Minimum Gradle Config"),(0,n.kt)("p",null,"Add to your module's ",(0,n.kt)("inlineCode",{parentName:"p"},"build.gradle.kts"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kotlin"},'repositories {\n  mavenCentral()\n}\n\ndependencies {\n\n  // core\n  implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.2")\n  implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.5.2")\n  implementation("com.rickbusarow.dispatch:dispatch-core:1.0.0-beta10-SNAPSHOT")\n\n  testImplementation("com.rickbusarow.dispatch:dispatch-test:1.0.0-beta10-SNAPSHOT")\n  testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.5.2")\n}\n')))}h.isMDXComponent=!0},3905:(t,e,i)=>{i.d(e,{Zo:()=>l,kt:()=>u});var r=i(7294);function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e){if(null==t)return{};var i,r,n=function(t,e){if(null==t)return{};var i,r,n={},o=Object.keys(t);for(r=0;r<o.length;r++)i=o[r],e.indexOf(i)>=0||(n[i]=t[i]);return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)i=o[r],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}var p=r.createContext({}),c=function(t){var e=r.useContext(p),i=e;return t&&(i="function"==typeof t?t(e):a(a({},e),t)),i},l=function(t){var e=c(t.components);return r.createElement(p.Provider,{value:e},t.children)},h={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},d=r.forwardRef((function(t,e){var i=t.components,n=t.mdxType,o=t.originalType,p=t.parentName,l=s(t,["components","mdxType","originalType","parentName"]),d=c(i),u=n,m=d["".concat(p,".").concat(u)]||d[u]||h[u]||o;return i?r.createElement(m,a(a({ref:e},l),{},{components:i})):r.createElement(m,a({ref:e},l))}));function u(t,e){var i=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var o=i.length,a=new Array(o);a[0]=d;var s={};for(var p in e)hasOwnProperty.call(e,p)&&(s[p]=e[p]);s.originalType=t,s.mdxType="string"==typeof t?t:n,a[1]=s;for(var c=2;c<o;c++)a[c]=i[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,i)}d.displayName="MDXCreateElement"},8209:(t,e,i)=>{i(7294)}}]);